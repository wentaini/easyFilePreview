<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶é¢„è§ˆå™¨</title>
    <script src="./js/tailwindcss.js"></script>
    <script src="./js/vue.global.js"></script>
    <script src="./js/marked.min.js"></script>
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/preview.css">
        

</head>
<body class="bg-gray-50">
    <!-- å¤åˆ¶æç¤ºå·¥å…· -->
    <div id="copyTooltip" class="copy-tooltip">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
    <div id="app" class="min-h-screen">
        <div class="container mx-auto px-4 py-8">
            <!-- å¤´éƒ¨ -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">æ–‡ä»¶é¢„è§ˆå™¨</h1>
                <p class="text-gray-600">æ”¯æŒé¢„è§ˆ PDFã€Excelã€Wordã€PowerPointã€Markdownã€æ–‡æœ¬ã€XML ç­‰æ ¼å¼æ–‡ä»¶</p>
            </div>

            <!-- æ–‡ä»¶URLè¾“å…¥ -->
            <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <label for="fileUrl" class="block text-sm font-medium text-gray-700 mb-2">æ–‡ä»¶URL</label>
                        <input 
                            type="url" 
                            id="fileUrl" 
                            v-model="fileUrl" 
                            placeholder="è¯·è¾“å…¥æ–‡ä»¶URLï¼Œä¾‹å¦‚: https://example.com/file.pdf"
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            @keyup.enter="previewFile"
                        >
                    </div>
                    <div class="flex items-end">
                        <button 
                            @click="previewFile" 
                            :disabled="!fileUrl || loading"
                            class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
                        >
                            <span v-if="loading" class="flex items-center gap-2">
                                <div class="loading-spinner w-4 h-4"></div>
                                é¢„è§ˆä¸­...
                            </span>
                            <span v-else>é¢„è§ˆæ–‡ä»¶</span>
                        </button>
                    </div>
                </div>
                
                <!-- ç¤ºä¾‹URL -->
                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-2">ç¤ºä¾‹URL:</p>
                    <div class="flex flex-wrap gap-2">
                        <button 
                            v-for="example in exampleUrls" 
                            :key="example.url"
                            @click="loadExample(example.url)"
                            class="text-xs px-3 py-1 bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors"
                        >
                            {{ example.name }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- é”™è¯¯ä¿¡æ¯ -->
            <div v-if="error" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">é¢„è§ˆå¤±è´¥</h3>
                        <div class="mt-2 text-sm text-red-700">
                            {{ error }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ–‡ä»¶ä¿¡æ¯ -->
            <div v-if="fileInfo" class="bg-white rounded-lg shadow-sm border p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">æ–‡ä»¶ä¿¡æ¯</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-500">æ–‡ä»¶å</label>
                        <p class="text-sm text-gray-900">{{ fileInfo.fileName }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-500">æ–‡ä»¶ç±»å‹</label>
                        <p class="text-sm text-gray-900">{{ fileInfo.extension.toUpperCase() }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-500">MIMEç±»å‹</label>
                        <p class="text-sm text-gray-900">{{ fileInfo.contentType }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-500">æ”¯æŒçŠ¶æ€</label>
                        <span v-if="fileInfo.isSupported" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            æ”¯æŒ
                        </span>
                        <span v-else class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                            ä¸æ”¯æŒ
                        </span>
                    </div>
                </div>
            </div>

            <!-- æ–‡ä»¶é¢„è§ˆå†…å®¹ -->
            <div v-if="previewData" class="file-preview-container">
                <!-- PDFé¢„è§ˆ -->
                <div v-if="previewData.type === 'pdf'" class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">PDFé¢„è§ˆ</h3>
                    
                    <!-- PDFä¿¡æ¯æç¤º -->
                    <div v-if="previewData.message || previewData.error || previewData.isImageBased" class="mb-4 p-4 rounded-lg">
                        <div v-if="previewData.isImageBased" class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-blue-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <h4 class="text-sm font-medium text-blue-800">å›¾ç‰‡å‹PDF</h4>
                                    <p class="text-sm text-blue-700 mt-1">æ­¤PDFä¸»è¦åŒ…å«æ‰«æå›¾ç‰‡å†…å®¹ï¼Œå»ºè®®ç›´æ¥æŸ¥çœ‹PDFæ–‡ä»¶ä»¥è·å¾—æœ€ä½³æ•ˆæœã€‚</p>
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="previewData.message && !previewData.isImageBased" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                                <p class="text-sm text-yellow-700">{{ previewData.message }}</p>
                            </div>
                        </div>
                        
                        <div v-if="previewData.error" class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-red-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                </svg>
                                <p class="text-sm text-red-700">è§£æé”™è¯¯: {{ previewData.error }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PDFæ–‡æœ¬é¢„è§ˆ -->
                    <div v-if="previewData.hasText && previewData.textPreview" class="mb-4">
                        <h4 class="text-md font-medium text-gray-900 mb-2">æ–‡æœ¬å†…å®¹é¢„è§ˆ</h4>
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-64 overflow-y-auto">
                            <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ previewData.textPreview }}</p>
                            <div v-if="previewData.totalTextLength > 1000" class="mt-2 text-xs text-gray-500">
                                æ˜¾ç¤ºå‰1000ä¸ªå­—ç¬¦ï¼Œæ€»é•¿åº¦: {{ previewData.totalTextLength }} å­—ç¬¦
                            </div>
                        </div>
                    </div>
                    
                    <!-- PDFé¡µé¢ä¿¡æ¯ -->
                    <div v-if="previewData.pageCount" class="mb-4 text-sm text-gray-600">
                        <p>æ€»é¡µæ•°: {{ previewData.pageCount }} é¡µ</p>
                    </div>
                    
                    <!-- PDFæŸ¥çœ‹å™¨ -->
                    <div class="pdf-container relative">
                        <iframe 
                            v-if="previewData.fileUrl"
                            :src="previewData.fileUrl"
                            class="pdf-viewer"
                            title="PDFé¢„è§ˆ"
                            width="100%"
                            height="100vh"
                            @load="handlePdfLoad"
                            @error="handlePdfError"
                        ></iframe>
                        
                        <!-- PDFåŠ è½½çŠ¶æ€ -->
                        <div v-if="pdfLoading && previewData.fileUrl" class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center">
                            <div class="text-center">
                                <div class="loading-spinner mx-auto mb-2"></div>
                                <p class="text-sm text-gray-600">æ­£åœ¨åŠ è½½PDF...</p>
                            </div>
                        </div>
                        
                        <!-- PDFé”™è¯¯çŠ¶æ€ -->
                        <div v-if="pdfError && previewData.fileUrl" class="absolute inset-0 bg-red-50 flex items-center justify-center">
                            <div class="text-center">
                                <svg class="w-12 h-12 text-red-400 mx-auto mb-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                </svg>
                                <p class="text-red-600 font-medium">PDFåŠ è½½å¤±è´¥</p>
                                <p class="text-sm text-red-500 mt-1">å¯èƒ½æ˜¯æ–‡ä»¶æŸåæˆ–æµè§ˆå™¨ä¸æ”¯æŒ</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ä¸‹è½½é“¾æ¥ -->
                    <div v-if="previewData.fileUrl" class="mt-4 text-center">
                        <a 
                            :href="previewData.fileUrl"
                            download="document.pdf"
                            class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                            ä¸‹è½½PDFæ–‡ä»¶
                        </a>
                    </div>
                </div>

                <!-- Excelé¢„è§ˆ -->
                <div v-else-if="previewData.type === 'excel'" class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Excelé¢„è§ˆ</h3>
                    
                    <!-- å·¥ä½œè¡¨æ ‡ç­¾ -->
                    <div v-if="previewData.sheetNames.length > 1" class="sheet-tabs mb-4">
                        <div 
                            v-for="sheetName in previewData.sheetNames" 
                            :key="sheetName"
                            @click="currentSheet = sheetName"
                            :class="['sheet-tab', currentSheet === sheetName ? 'active' : '']"
                        >
                            {{ sheetName }}
                        </div>
                    </div>

                    <!-- è¡¨æ ¼å†…å®¹ -->
                    <div class="overflow-x-auto relative">
                        <table class="excel-table">
                            <thead>
                                <tr>
                                    <th v-for="(cell, index) in currentSheetData[0] || []" :key="index">
                                        {{ cell || `åˆ—${index + 1}` }}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(row, rowIndex) in currentSheetData.slice(1)" :key="rowIndex">
                                    <td v-for="(cell, cellIndex) in row" :key="cellIndex" 
                                        @click="copyCellContent(cell, rowIndex + 1, cellIndex + 1)"
                                        :title="`ç‚¹å‡»å¤åˆ¶: ${cell || ''}`">
                                        <span v-if="cell !== null && cell !== undefined">{{ cell }}</span>
                                        <span v-else class="text-gray-300">-</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <!-- å›¾ç‰‡è¦†ç›–å±‚ -->
                        <div class="excel-images-overlay absolute top-0 left-0 w-full h-full pointer-events-none">
                            <div 
                                v-for="image in currentSheetImages" 
                                :key="image.id"
                                class="excel-image absolute"
                                :style="{
                                    top: (image.position.row * 40) + 'px',
                                    left: (image.position.col * 120) + 'px',
                                    width: (image.position.width * 120) + 'px',
                                    height: (image.position.height * 40) + 'px',
                                    zIndex: 10
                                }"
                            >
                                                            <img 
                                v-if="image.src && image.src !== `data:${image.type};base64,`"
                                :src="image.src" 
                                :alt="image.name"
                                class="w-full h-full object-contain border border-gray-300 rounded"
                                @error="handleImageError(image, $event)"
                                style="pointer-events: auto;"
                            />
                            <div v-else class="w-full h-full flex items-center justify-center bg-gray-100 text-gray-500 text-xs">
                                å›¾ç‰‡æ— æ•ˆ
                            </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å·¥ä½œè¡¨ä¿¡æ¯ -->
                    <div v-if="previewData.sheetInfo && previewData.sheetInfo[currentSheet]" class="mt-4 text-sm text-gray-600">
                        <p>å·¥ä½œè¡¨: {{ currentSheet }} | è¡Œæ•°: {{ previewData.sheetInfo[currentSheet].maxRow }} | åˆ—æ•°: {{ previewData.sheetInfo[currentSheet].maxCol }} | å›¾ç‰‡æ•°: {{ previewData.sheetInfo[currentSheet].imageCount || 0 }}</p>
                    </div>
                    
                    <!-- å›¾ç‰‡åˆ—è¡¨ -->
                    <div v-if="currentSheetImages.length > 0" class="mt-4">
                        <h4 class="text-md font-medium text-gray-900 mb-2">å·¥ä½œè¡¨å›¾ç‰‡ ({{ currentSheetImages.length }})</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                            <div 
                                v-for="image in currentSheetImages" 
                                :key="image.id"
                                class="image-thumbnail"
                            >
                                <img 
                                    v-if="image.src && image.src !== `data:${image.type};base64,`"
                                    :src="image.src" 
                                    :alt="image.name"
                                    class="w-full h-24 object-cover border border-gray-300 rounded"
                                    @error="handleImageError(image, $event)"
                                />
                                <div v-else class="w-full h-24 flex items-center justify-center bg-gray-100 text-gray-500 text-xs border border-gray-300 rounded">
                                    å›¾ç‰‡æ— æ•ˆ
                                </div>
                                <p class="text-xs text-gray-600 mt-1 truncate">{{ image.name }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CSVé¢„è§ˆ -->
                <div v-else-if="previewData.type === 'csv'" class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">CSVæ–‡ä»¶é¢„è§ˆ</h3>
                    <div class="bg-white border rounded-lg p-6">
                        <!-- æ–‡ä»¶ä¿¡æ¯ -->
                        <div class="mb-4 text-sm text-gray-600">
                            <p>æ€»è¡Œæ•°: {{ previewData.maxRows }} | æ€»åˆ—æ•°: {{ previewData.maxCols }}</p>
                        </div>
                        
                        <!-- è¡¨æ ¼å†…å®¹ -->
                        <div class="overflow-x-auto">
                            <table class="excel-table">
                                <thead>
                                    <tr>
                                        <th v-for="(cell, index) in previewData.data[0] || []" :key="index">
                                            {{ cell || `åˆ—${index + 1}` }}
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(row, rowIndex) in previewData.data.slice(1)" :key="rowIndex">
                                        <td v-for="(cell, cellIndex) in row" :key="cellIndex" 
                                            @click="copyCellContent(cell, rowIndex + 1, cellIndex + 1)"
                                            :title="`ç‚¹å‡»å¤åˆ¶: ${cell || ''}`">
                                            <span v-if="cell !== null && cell !== undefined && cell !== ''">{{ cell }}</span>
                                            <span v-else class="text-gray-300">-</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Wordé¢„è§ˆ -->
                <div v-else-if="previewData.type === 'word'" class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Wordæ–‡æ¡£é¢„è§ˆ</h3>
                    <div class="bg-white border rounded-lg p-6">
                        <div v-if="previewData.contentType === 'text/html'" 
                             v-html="previewData.content" 
                             class="word-content">
                        </div>
                        <div v-else class="text-content">
                            {{ previewData.content }}
                        </div>
                    </div>
                </div>

                <!-- PowerPointé¢„è§ˆ -->
                <div v-else-if="previewData.type === 'powerpoint'" class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">PowerPointé¢„è§ˆ</h3>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <div v-if="previewData.slideCount > 0" class="mb-4">
                            <h4 class="text-md font-medium text-blue-900 mb-2">å¹»ç¯ç‰‡ä¿¡æ¯</h4>
                            <p class="text-blue-700">æ€»å¹»ç¯ç‰‡æ•°: {{ previewData.slideCount }}</p>
                        </div>
                        <div v-if="previewData.contentType === 'text/html'" 
                             v-html="previewData.content" 
                             class="powerpoint-content">
                        </div>
                        <div v-else class="text-content">
                            {{ previewData.content }}
                        </div>
                    </div>
                </div>

                <!-- Markdowné¢„è§ˆ -->
                <div v-else-if="previewData.type === 'markdown'" class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Markdowné¢„è§ˆ</h3>
                    <div class="markdown-content" v-html="previewData.content"></div>
                </div>

                <!-- æ–‡æœ¬é¢„è§ˆ -->
                <div v-else-if="previewData.type === 'text'" class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">æ–‡æœ¬é¢„è§ˆ</h3>
                    <div class="text-content">{{ previewData.content }}</div>
                </div>

                <!-- XMLé¢„è§ˆ -->
                <div v-else-if="previewData.type === 'xml'" class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">XMLé¢„è§ˆ</h3>
                    <div class="xml-content">{{ previewData.content }}</div>
                </div>
            </div>

            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="mt-8 bg-white rounded-lg shadow-sm border p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ä½¿ç”¨è¯´æ˜</h2>
                <div class="prose max-w-none">
                    <h3 class="text-md font-medium text-gray-900 mb-2">æ”¯æŒçš„æ ¼å¼</h3>
                    <ul class="list-disc list-inside text-sm text-gray-600 mb-4 space-y-1">
                        <li>PDFæ–‡æ¡£ (.pdf)</li>
                        <li>Excelå·¥ä½œç°¿ (.xls, .xlsx)</li>
                        <li>CSVæ–‡ä»¶ (.csv)</li>
                        <li>Wordæ–‡æ¡£ (.doc, .docx)</li>
                        <li>PowerPointæ¼”ç¤ºæ–‡ç¨¿ (.ppt, .pptx)</li>
                        <li>Markdownæ–‡æ¡£ (.md, .markdown)</li>
                        <li>æ–‡æœ¬æ–‡ä»¶ (.txt)</li>
                        <li>XMLæ–‡æ¡£ (.xml)</li>
                    </ul>
                    
                    <h3 class="text-md font-medium text-gray-900 mb-2">iframeå¼•ç”¨</h3>
                    <p class="text-sm text-gray-600 mb-2">æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åœ¨å…¶ä»–é¡µé¢ä¸­åµŒå…¥æ–‡ä»¶é¢„è§ˆï¼š</p>
                    <div class="bg-gray-100 p-3 rounded text-sm font-mono text-gray-800">
                        &lt;iframe src="/filePreview.html?url=YOUR_FILE_URL" width="100%" height="600"&gt;&lt;/iframe&gt;
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    fileUrl: '',
                    loading: false,
                    error: null,
                    fileInfo: null,
                    previewData: null,
                    currentSheet: null,
                    pdfLoading: false,
                    pdfError: false,

                    exampleUrls: [
                        {
                            name: 'ç¤ºä¾‹PDF',
                            url: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
                        },
                        {
                            name: 'ç¤ºä¾‹Excel',
                            url: 'https://file-examples.com/storage/feaade38c1651bd01984236/2017/10/file_example_XLS_10.xls'
                        },
                        {
                            name: 'ç¤ºä¾‹æ–‡æœ¬',
                            url: 'https://www.w3.org/TR/PNG/iso_8859-1.txt'
                        }
                    ]
                }
            },
            computed: {
                currentSheetData() {
                    if (!this.previewData || this.previewData.type !== 'excel' || !this.currentSheet) {
                        return [];
                    }
                    return this.previewData.sheets[this.currentSheet] || [];
                },
                currentSheetImages() {
                    if (!this.previewData || this.previewData.type !== 'excel' || !this.currentSheet) {
                        return [];
                    }
                    return this.previewData.images[this.currentSheet] || [];
                }
            },
            methods: {
                async previewFile() {
                    if (!this.fileUrl) {
                        this.error = 'è¯·è¾“å…¥æ–‡ä»¶URL';
                        return;
                    }

                    this.loading = true;
                    this.error = null;
                    this.fileInfo = null;
                    this.previewData = null;
                    this.pdfLoading = false;
                    this.pdfError = false;

                    try {
                        console.log('ğŸ” å¼€å§‹é¢„è§ˆæ–‡ä»¶:', this.fileUrl);
                        const response = await fetch(`/api/filePreview/preview?url=${encodeURIComponent(this.fileUrl)}`);
                        const result = await response.json();

                        console.log('ğŸ“‹ APIå“åº”:', result);

                        if (result.success) {
                            this.fileInfo = result.data.fileInfo;
                            this.previewData = result.data.preview;
                            
                            console.log('ğŸ“Š é¢„è§ˆæ•°æ®:', this.previewData);
                            
                            // å¦‚æœæ˜¯PDFæ–‡ä»¶ï¼Œè®¾ç½®åŠ è½½çŠ¶æ€
                            if (this.previewData.type === 'pdf') {
                                this.pdfLoading = true;
                                this.pdfError = false;
                            }
                            
                            // è®¾ç½®é»˜è®¤å·¥ä½œè¡¨
                            if (this.previewData.type === 'excel' && this.previewData.sheetNames.length > 0) {
                                this.currentSheet = this.previewData.sheetNames[0];
                                console.log('ğŸ“‹ è®¾ç½®é»˜è®¤å·¥ä½œè¡¨:', this.currentSheet);
                            }
                            
                            // æ£€æŸ¥å›¾ç‰‡æ•°æ®
                            if (this.previewData.images) {
                                console.log('ğŸ–¼ï¸  å›¾ç‰‡æ•°æ®:', this.previewData.images);
                                Object.keys(this.previewData.images).forEach(sheetName => {
                                    const images = this.previewData.images[sheetName];
                                    console.log(`å·¥ä½œè¡¨ ${sheetName} å›¾ç‰‡æ•°é‡:`, images.length);
                                });
                            }
                        } else {
                            this.error = result.message;
                            console.error('âŒ é¢„è§ˆå¤±è´¥:', result.message);
                            if (result.data && result.data.fileInfo) {
                                this.fileInfo = result.data.fileInfo;
                            }
                        }
                    } catch (error) {
                        this.error = `è¯·æ±‚å¤±è´¥: ${error.message}`;
                        console.error('âŒ è¯·æ±‚å¼‚å¸¸:', error);
                    } finally {
                        this.loading = false;
                    }
                },
                loadExample(url) {
                    this.fileUrl = url;
                    this.previewFile();
                },
                handleImageError(image, event) {
                    console.error('ğŸ–¼ï¸  å›¾ç‰‡åŠ è½½å¤±è´¥:', image.name, event);
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å›¾ç‰‡åŠ è½½å¤±è´¥çš„å¤„ç†é€»è¾‘
                    // æ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªå ä½ç¬¦å›¾ç‰‡
                },
                copyCellContent(content, row, col) {
                    if (content === null || content === undefined || content === '') {
                        return;
                    }
                    
                    const textToCopy = String(content);
                    
                    // ä½¿ç”¨ç°ä»£æµè§ˆå™¨çš„ Clipboard API
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(textToCopy).then(() => {
                            this.showCopyTooltip(`å·²å¤åˆ¶: ${textToCopy}`, row, col);
                        }).catch(err => {
                            console.error('å¤åˆ¶å¤±è´¥:', err);
                            this.fallbackCopy(textToCopy, row, col);
                        });
                    } else {
                        // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿçš„ document.execCommand
                        this.fallbackCopy(textToCopy, row, col);
                    }
                },
                showCopyTooltip(message, row, col) {
                    const tooltip = document.getElementById('copyTooltip');
                    if (tooltip) {
                        tooltip.textContent = message;
                        tooltip.classList.add('show');
                        
                        // 2ç§’åéšè—æç¤º
                        setTimeout(() => {
                            tooltip.classList.remove('show');
                        }, 2000);
                    }
                },
                fallbackCopy(text, row, col) {
                    // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸ
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            this.showCopyTooltip(`å·²å¤åˆ¶: ${text}`, row, col);
                        } else {
                            this.showCopyTooltip('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬', row, col);
                        }
                    } catch (err) {
                        console.error('å¤åˆ¶å¤±è´¥:', err);
                        this.showCopyTooltip('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬', row, col);
                    }
                    
                    document.body.removeChild(textArea);
                },
                handlePdfLoad() {
                    console.log('âœ… PDFåŠ è½½æˆåŠŸ');
                    this.pdfLoading = false;
                    this.pdfError = false;
                },
                handlePdfError() {
                    console.error('âŒ PDFåŠ è½½å¤±è´¥');
                    this.pdfLoading = false;
                    this.pdfError = true;
                }
            },
            mounted() {
                // ä»URLå‚æ•°ä¸­è·å–æ–‡ä»¶URL
                const urlParams = new URLSearchParams(window.location.search);
                const url = urlParams.get('url');
                if (url) {
                    this.fileUrl = url;
                    this.previewFile();
                }
            }
        }).mount('#app');
        
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(event) {
            console.error('ğŸŒ å…¨å±€é”™è¯¯:', event.error);
            console.error('é”™è¯¯ä¿¡æ¯:', event.message);
            console.error('é”™è¯¯æ–‡ä»¶:', event.filename);
            console.error('é”™è¯¯è¡Œå·:', event.lineno);
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('ğŸŒ æœªå¤„ç†çš„Promiseæ‹’ç»:', event.reason);
        });
    </script>
</body>
</html> 